<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>Client Dashboard | Hollcroft Analytics | Tulsa, OK</title>

    <meta name="description"
          content="Secure client dashboard by Hollcroft Analytics in Tulsa, OK. Dashboards, reporting, and business intelligence.">

    <meta name="robots" content="noindex, nofollow">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Main site styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- Social preview -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Client Dashboard | Hollcroft Analytics">
    <meta property="og:description" content="Secure client dashboard by Hollcroft Analytics">
    <meta property="og:image" content="{{ url_for('static', filename='logo.png', _external=True) }}">
</head>

<body class="jc-dash">

<!-- NAVBAR -->
<header class="navbar">
    <div class="brand">
        <div class="brand-text">
            <div class="brand-name">Hollcroft Analytics</div>
            <div class="brand-sub">Tulsa, Oklahoma</div>
        </div>
    </div>

    <nav class="nav-links">
        <a href="{{ url_for('home') }}">Home</a>
        <a href="{{ url_for('contact') }}">Contact</a>
        <a href="{{ url_for('logout') }}" class="nav-login">Logout</a>
    </nav>

    <button class="nav-toggle" aria-label="Toggle navigation">&#9776;</button>
</header>

<!-- LOGO -->
<div class="text-center mb-4">
    <img
        src="{{ url_for('static', filename='logo.png') }}"
        alt="Hollcroft Analytics logo — Tulsa, Oklahoma data analytics"
        class="dashboard-logo"
        loading="lazy">
</div>

<main id="main-content" role="main">

{% set ftc_bar_class =
    'bg-success' if first_time_completion_pct >= first_time_completion_target
    else 'bg-warning' if first_time_completion_pct >= 75
    else 'bg-danger'
%}

<!-- KPI CARD -->
<div class="kpi-wrap">
    <section class="kpi-card" aria-labelledby="kpi-ftc-title">

        <div class="d-flex justify-content-between align-items-start">
            <div>
                <div class="text-muted jc-kpi-kicker">Quality KPI</div>

                <h2 id="kpi-ftc-title" class="jc-kpi-title">
                    First-Time Completion
                </h2>

                <div class="ftc-percentage">
                    {{ first_time_completion_pct }}%
                </div>

                <div class="ftc-sub">
                    Target: {{ first_time_completion_target }}%
                    • Completed jobs counted: {{ completed_jobs }}
                </div>
            </div>

            <div class="text-end">
                <div class="text-muted jc-refresh-label">Last refreshed</div>
                <div class="jc-refresh-value">{{ last_refresh }}</div>
            </div>
        </div>

        <div class="mt-3">
            <div class="progress">
                <div
                    id="ftc-progress-bar"
                    class="progress-bar {{ ftc_bar_class }} progress-bar-striped"
                    role="progressbar"
                    data-ftc="{{ first_time_completion_pct }}"
                    aria-valuenow="{{ first_time_completion_pct }}"
                    aria-valuemin="0"
                    aria-valuemax="100">
                    {{ first_time_completion_pct }}%
                </div>
            </div>
        </div>

        <div class="mini-metrics">
            <div class="mini-metric">
                <div class="label">First-time (1 appt)</div>
                <div class="value">{{ first_time_completed }}</div>
            </div>
            <div class="mini-metric">
                <div class="label">Repeat visit (2+)</div>
                <div class="value">{{ repeat_visit_completed }}</div>
            </div>
            <div class="mini-metric">
                <div class="label">Repeat-visit rate</div>
                <div class="value">{{ repeat_visit_pct }}%</div>
            </div>
        </div>

    </section>
</div>

<!-- REPEAT JOBS TABLE -->
<section class="section-card" aria-labelledby="repeat-jobs-title">

    <h2 id="repeat-jobs-title" class="section-title">
        Repeat-Visit Completed Jobs (2+ appointments)
    </h2>

    <p class="text-muted jc-section-note">
        These jobs required at least one return trip. Reviewing these is the fastest way
        to improve First-Time Completion.
    </p>

    <div class="table-responsive">
        <table class="table table-sm table-striped align-middle">
            <thead>
                <tr>
                    <th scope="col">Completed</th>
                    <th scope="col">Customer</th>
                    <th scope="col">Appointments</th>
                    <th scope="col">Status</th>
                    <th scope="col">Description</th>
                </tr>
            </thead>
            <tbody>
                {% if repeat_jobs and repeat_jobs|length > 0 %}
                    {% for r in repeat_jobs %}
                        <tr>
                            <td>{{ r.completed_at_central }}</td>
                            <td>{{ r.customer_name }}</td>
                            <td>
                                <span class="badge text-bg-secondary">
                                    {{ r.num_appointments }}
                                </span>
                            </td>
                            <td>{{ r.work_status }}</td>
                            <td class="jc-desc-cell">{{ r.description }}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" class="text-muted">
                            No repeat-visit completed jobs found.
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

</section>

<div class="text-center mb-3 jc-last-refresh">
    <p class="text-muted">Last refreshed: {{ last_refresh }}</p>
</div>

</main>

<footer>
    <p>© 2026 Hollcroft Analytics · Tulsa, Oklahoma · Data Analytics & Business Intelligence</p>
</footer>

<!-- Scripts -->
<script>
    const ftcBar = document.getElementById("ftc-progress-bar");
    if (ftcBar) {
        const pct = parseFloat(ftcBar.dataset.ftc || "0");
        ftcBar.style.width = Math.max(0, Math.min(100, pct)) + "%";
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const navToggle = document.querySelector('.nav-toggle');
    const navLinks = document.querySelector('.nav-links');
    if (navToggle && navLinks) {
        navToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });
    }
</script>

</body>
</html>
