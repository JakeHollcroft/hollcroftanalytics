<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Client Dashboard | Hollcroft Analytics | Tulsa, OK</title>
    <meta name="description" content="Secure client dashboard by Hollcroft Analytics in Tulsa, OK. Dashboards, reporting, and business intelligence.">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Main site styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- Social preview -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Client Dashboard | Hollcroft Analytics">
    <meta property="og:description" content="Secure client dashboard by Hollcroft Analytics">
    <meta property="og:image" content="{{ url_for('static', filename='logo.png', _external=True) }}">
</head>

<body class="jc-dash">

<!-- NAVBAR -->
<header class="navbar">
    <div class="brand">
        <div class="brand-text">
            <div class="brand-name">Hollcroft Analytics</div>
            <div class="brand-sub">Tulsa, Oklahoma</div>
        </div>
    </div>

    <nav class="nav-links">
        <a href="{{ url_for('home') }}">Home</a>
        <a href="{{ url_for('contact') }}">Contact</a>
        <a href="{{ url_for('logout') }}" class="nav-login">Logout</a>
    </nav>

    <button class="nav-toggle" aria-label="Toggle navigation">&#9776;</button>
</header>

<!-- LOGO -->
<div class="jc-logo-container">
    <img src="{{ url_for('static', filename='logo.png') }}" 
         alt="Hollcroft Analytics logo – Tulsa, Oklahoma data analytics" 
         class="dashboard-logo"
         loading="lazy">
</div>

<main id="main-content" role="main">

{% set ftc_bar_class = 'bg-success' if first_time_completion_pct >= first_time_completion_target else 'bg-warning' if first_time_completion_pct >= 75 else 'bg-danger' %}

<!-- TOP KPI GRID -->
<section class="jc-kpi-grid" aria-label="Top KPIs">

    <!-- REVENUE TOTAL CARD -->
    <article class="jc-kpi-card jc-kpi-revenue" aria-labelledby="rev-total-title">
        <div class="jc-kpi-header">
            <div class="jc-kpi-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
            </div>
            <div class="jc-kpi-meta">
                <div class="jc-kpi-label">Total Revenue (YTD)</div>
                <div class="jc-kpi-badge">Revenue KPI</div>
            </div>
        </div>
        
        <div class="jc-kpi-value">
            {{ total_revenue_ytd_display }}
        </div>
        
        <div class="jc-kpi-footer">
            <span class="jc-kpi-note">Includes: paid, open, pending_payment</span>
        </div>
    </article>

    <!-- REVENUE BREAKDOWN CARD -->
    <article class="jc-kpi-card jc-kpi-breakdown" aria-labelledby="rev-breakdown-title">
        <div class="jc-kpi-header">
            <div class="jc-kpi-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
            </div>
            <div class="jc-kpi-meta">
                <div class="jc-kpi-label">Revenue by Category (YTD)</div>
                <div class="jc-kpi-badge">Breakdown</div>
            </div>
        </div>
        
        <div class="jc-revenue-bars">
            {% if revenue_breakdown_ytd and revenue_breakdown_ytd|length > 0 %}
                {% for r in revenue_breakdown_ytd %}
                <div class="jc-revenue-bar-row">
                    <div class="jc-revenue-bar-label">{{ r.category }}</div>
                    <div class="jc-revenue-bar-track">
                        <div class="jc-revenue-bar-fill" data-width="{{ (loop.index / revenue_breakdown_ytd|length * 100)|int }}"></div>
                    </div>
                    <div class="jc-revenue-bar-value">{{ r.revenue_display }}</div>
                </div>
                {% endfor %}
            {% else %}
                <div class="jc-empty-state">
                    <p>No revenue data available</p>
                </div>
            {% endif %}
        </div>
        
        <div class="jc-kpi-footer">
            <span class="jc-kpi-note">Categories from job tags</span>
        </div>
    </article>

    <!-- DFO (DIAGNOSTIC FEE ONLY) CARD -->
    <article class="jc-kpi-card jc-kpi-dfo" aria-labelledby="kpi-dfo-title">
        <div class="jc-kpi-header">
            <div class="jc-kpi-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 6v6l4 2"></path>
                </svg>
            </div>
            <div class="jc-kpi-meta">
                <div class="jc-kpi-label">DFO Rate (YTD)</div>
                <div class="jc-kpi-badge">Quality KPI</div>
            </div>
        </div>
        
        <div class="jc-dfo-main">
            <div class="jc-dfo-percentage">
                <span class="jc-dfo-value" style="color: {% if dfo_status_color == 'success' %}#28a745{% elif dfo_status_color == 'warning' %}#ffc107{% else %}#dc3545{% endif %};">
                    {{ dfo_pct }}%
                </span>
                <span class="jc-dfo-count">{{ dfo_count }} of {{ completed_jobs }} jobs</span>
            </div>
            
            <div class="jc-dfo-threshold">
                <span class="jc-threshold-label">Target:</span>
                <span class="jc-threshold-value" style="color: #28a745;">&lt; 5%</span>
                {% if dfo_pct < 5 %}
                    <span class="jc-threshold-status" style="color: #28a745;">✓ On Target</span>
                {% elif dfo_pct < 10 %}
                    <span class="jc-threshold-status" style="color: #ffc107;">⚠ Monitor</span>
                {% else %}
                    <span class="jc-threshold-status" style="color: #dc3545;">✗ Action Needed</span>
                {% endif %}
            </div>
        </div>
        
        <div class="jc-kpi-footer">
            <span class="jc-kpi-note">Service jobs with no installation/change-out</span>
        </div>
    </article>

    <!-- FIRST-TIME COMPLETION CARD -->
<article class="jc-kpi-card jc-kpi-ftc jc-kpi-wide" aria-labelledby="kpi-ftc-title">
  <div class="jc-ftc-layout">
    <div class="jc-ftc-left">
      <div class="jc-kpi-header">
        <div class="jc-kpi-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        </div>
        <div class="jc-kpi-meta">
          <div class="jc-kpi-label">First-Time Completion</div>
          <div class="jc-kpi-badge">Quality KPI</div>
        </div>
      </div>

      <div class="jc-ftc-gauge">
        <svg viewBox="0 0 200 200" class="jc-gauge-svg">
          <!-- Background ring -->
          <circle cx="100" cy="100" r="80" class="jc-gauge-bg"></circle>

          <!-- Animated ring -->
          <circle
            cx="100" cy="100" r="80"
            class="jc-gauge-fill"
            data-percent="{{ first_time_completion_pct }}">
          </circle>

          <!-- Animated number (keep UPRIGHT: no transform here) -->
          <text
            x="100" y="95"
            class="jc-gauge-value"
            data-target="{{ first_time_completion_pct }}">
            0%
          </text>

          <text
            x="100" y="115"
            class="jc-gauge-label">
            Complete
          </text>
        </svg>
      </div>

      <div class="jc-ftc-target">
        <span class="jc-target-label">Target:</span>
        <span class="jc-target-value">{{ first_time_completion_target }}%</span>
      </div>
    </div>

    <div class="jc-ftc-right">
      <div class="jc-ftc-stats">
        <div class="jc-stat-card">
          <div class="jc-stat-icon">✓</div>
          <div class="jc-stat-value">{{ first_time_completed }}</div>
          <div class="jc-stat-label">First-time (1 appt)</div>
        </div>

        <div class="jc-stat-card">
          <div class="jc-stat-icon">↻</div>
          <div class="jc-stat-value">{{ repeat_visit_completed }}</div>
          <div class="jc-stat-label">Repeat visit (2+)</div>
        </div>

        <div class="jc-stat-card">
          <div class="jc-stat-icon">%</div>
          <div class="jc-stat-value">{{ repeat_visit_pct }}%</div>
          <div class="jc-stat-label">Repeat-visit rate</div>
        </div>

        <div class="jc-stat-card">
          <div class="jc-stat-icon">#</div>
          <div class="jc-stat-value">{{ completed_jobs }}</div>
          <div class="jc-stat-label">Total completed</div>
        </div>
      </div>

      <div class="jc-ftc-refresh">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 4 23 10 17 10"></polyline>
          <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
        </svg>
        <span class="jc-refresh-label">Last refreshed: {{ last_refresh }}</span>
      </div>
    </div>
  </div>
</article>

</section>

<!-- ROADMAP SECTION -->
<section class="jc-roadmap-section">
    <div class="jc-roadmap-header">
        <h2 class="jc-roadmap-title">KPI Roadmap</h2>
        
        <div class="jc-progress-stats">
            <span id="roadmap-done">0</span>/<span id="roadmap-total">0</span> items
            <span class="jc-progress-dot">•</span>
            <span id="roadmap-pct">0</span>%
        </div>
        
        <div class="jc-progress-bar-container">
            <div id="roadmap-progress-bar" class="jc-progress-bar-fill"></div>
        </div>
    </div>

    <div class="jc-phases-grid">
        <!-- PHASE 1 -->
        <article class="jc-phase-card" aria-label="Phase 1">
            <div class="jc-phase-header">
                <h3 class="jc-phase-title">Phase 1</h3>
                <div class="jc-phase-tags">
                    <span class="jc-tag jc-tag-green">Quick Wins</span>
                    <span class="jc-tag jc-tag-blue">Low Complexity</span>
                </div>
            </div>
            
            <div class="jc-phase-tasks">
                <div class="jc-task-item jc-task-done" data-done="1">
                    <div class="jc-task-checkbox">✓</div>
                    <div class="jc-task-content">
                        <div class="jc-task-name">Total revenue by department</div>
                        <div class="jc-task-desc">Residential, commercial, maintenance, demand service, change out, plus service plan revenue.</div>
                        <div class="jc-task-meta">
                            <span class="jc-difficulty jc-diff-easy">Very Easy</span>
                            <span class="jc-task-status jc-status-complete">Complete</span>
                        </div>
                    </div>
                </div>

                <div class="jc-task-item jc-task-done" data-done="1">
                    <div class="jc-task-checkbox">✓</div>
                    <div class="jc-task-content">
                        <div class="jc-task-name">DFO (Diagnostic Fee Only)</div>
                        <div class="jc-task-desc">Monthly and yearly. Flag under 5% as green.</div>
                        <div class="jc-task-meta">
                            <span class="jc-difficulty jc-diff-medium">Medium</span>
                            <span class="jc-task-status jc-status-in-progress">In Progress</span>
                        </div>
                    </div>
                </div>

                <div class="jc-task-item" data-done="0">
                    <div class="jc-task-checkbox"></div>
                    <div class="jc-task-content">
                        <div class="jc-task-name">Average ticket (service only)</div>
                        <div class="jc-task-desc">Overall and per technician. Flag under $450.</div>
                        <div class="jc-task-meta">
                            <span class="jc-difficulty jc-diff-easy">Easy</span>
                            <span class="jc-task-status">Not Started</span>
                        </div>
                    </div>
                </div>

                <div class="jc-task-item" data-done="0">
                    <div class="jc-task-checkbox"></div>
                    <div class="jc-task-content">
                        <div class="jc-task-name">Lead turnover</div>
                        <div class="jc-task-desc">Estimate won vs lost, estimate vs call.</div>
                        <div class="jc-task-meta">
                            <span class="jc-difficulty jc-diff-medium">Easy–Medium</span>
                            <span class="jc-task-status">Not Started</span>
                        </div>
                    </div>
                </div>
            </div>
        </article>

        <!-- PHASE 2 -->
        <article class="jc-phase-card" aria-label="Phase 2">
            <div class="jc-phase-header">
                <h3 class="jc-phase-title">Phase 2</h3>
                <div class="jc-phase-tags">
                    <span class="jc-tag jc-tag-purple">Operational</span>
                    <span class="jc-tag jc-tag-yellow">Med Complexity</span>
                </div>
            </div>
            
            <div class="jc-phase-tasks">
                <div class="jc-task-item" data-done="0">
                    <div class="jc-task-checkbox"></div>
                    <div class="jc-task-content">
                        <div class="jc-task-name">Club agreement conversions</div>
                        <div class="jc-task-desc">Service calls with Wizard Club member, conversion rate, flag under 50% as red.</div>
                        <div class="jc-task-meta">
                            <span class="jc-difficulty jc-diff-medium">Medium</span>
                            <span class="jc-task-status">Not Started</span>
                        </div>
                    </div>
                </div>

                <div class="jc-task-item" data-done="0">
                    <div class="jc-task-checkbox"></div>
                    <div class="jc-task-content">
                        <div class="jc-task-name">Callback percentage</div>
                        <div class="jc-task-desc">Service and install crews. Thresholds: ≤3% green, 3–7% orange, ≥8% red.</div>
                        <div class="jc-task-meta">
                            <span class="jc-difficulty jc-diff-hard">Medium–Hard</span>
                            <span class="jc-task-status">Not Started</span>
                        </div>
                    </div>
                </div>

                <div class="jc-task-item" data-done="0">
                    <div class="jc-task-checkbox"></div>
                    <div class="jc-task-content">
                        <div class="jc-task-name">Residential budget progress</div>
                        <div class="jc-task-desc">How much until monthly budget target is met (requires monthly target value).</div>
                        <div class="jc-task-meta">
                            <span class="jc-difficulty jc-diff-medium">Medium</span>
                            <span class="jc-task-status">Not Started</span>
                        </div>
                    </div>
                </div>

                <div class="jc-task-item" data-done="0">
                    <div class="jc-task-checkbox"></div>
                    <div class="jc-task-content">
                        <div class="jc-task-name">Revenue per employee</div>
                        <div class="jc-task-desc">Requires definition of active employees and time windows.</div>
                        <div class="jc-task-meta">
                            <span class="jc-difficulty jc-diff-hard">Hard</span>
                            <span class="jc-task-status">Not Started</span>
                        </div>
                    </div>
                </div>
            </div>
        </article>

        <!-- PHASE 3 -->
        <article class="jc-phase-card jc-phase-wide" aria-label="Phase 3">
            <div class="jc-phase-header">
                <h3 class="jc-phase-title">Phase 3</h3>
                <div class="jc-phase-tags">
                    <span class="jc-tag jc-tag-red">Advanced</span>
                    <span class="jc-tag jc-tag-orange">High Complexity</span>
                    <span class="jc-tag jc-tag-teal">Premium KPIs</span>
                </div>
            </div>
            
            <div class="jc-phase-tasks">
                <div class="jc-task-item" data-done="0">
                    <div class="jc-task-checkbox"></div>
                    <div class="jc-task-content">
                        <div class="jc-task-name">Service efficiency (billed hours vs paid hours)</div>
                        <div class="jc-task-desc">Billed hours vs paid hours</div>
                        <div class="jc-task-meta">
                            <span class="jc-difficulty jc-diff-hard">Hard</span>
                            <span class="jc-task-status">Not Started</span>
                        </div>
                    </div>
                </div>

                <div class="jc-task-item" data-done="0">
                    <div class="jc-task-checkbox"></div>
                    <div class="jc-task-content">
                        <div class="jc-task-name">Gross profit per job per technician per hour</div>
                        <div class="jc-task-desc">Needs parts cost, parts duration, job classification, fixed labor assumption ($525), and clear attribution rules for multi-tech jobs. Target: $150/hr or greater is green.</div>
                        <div class="jc-task-meta">
                            <span class="jc-difficulty jc-diff-hard">Very Hard</span>
                            <span class="jc-task-status">Not Started</span>
                        </div>
                    </div>
                </div>

                <div class="jc-task-item" data-done="0">
                    <div class="jc-task-checkbox"></div>
                    <div class="jc-task-content">
                        <div class="jc-task-name">Per technician KPI cards</div>
                        <div class="jc-task-desc">Cards per employee: average ticket, gross profit/hr, callbacks, first-time completion, DFO.</div>
                        <div class="jc-task-meta">
                            <span class="jc-difficulty jc-diff-medium">Medium</span>
                            <span class="jc-task-status">Not Started</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="jc-phase-note">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                <span>Hard items depend on definitions and consistent tagging. If definitions change midstream, KPI logic may require rework.</span>
            </div>
        </article>
    </div>
</section>

<!-- REPEAT JOBS SECTION -->
<section class="jc-data-card" aria-labelledby="repeat-jobs-title">
    <div class="jc-data-header">
        <div class="jc-data-title-group">
            <h2 id="repeat-jobs-title" class="jc-section-title">Repeat-Visit Completed Jobs</h2>
            <p class="jc-data-subtitle">Jobs requiring 2+ appointments - review to improve First-Time Completion</p>
        </div>
    </div>

    <div class="jc-table-container">
        <table class="jc-data-table">
            <thead>
                <tr>
                    <th>Completed</th>
                    <th>Customer</th>
                    <th>Appointments</th>
                    <th>Status</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                {% if repeat_jobs and repeat_jobs|length > 0 %}
                    {% for r in repeat_jobs %}
                    <tr>
                        <td>{{ r.completed_at_central }}</td>
                        <td class="jc-cell-bold">{{ r.customer_name }}</td>
                        <td>
                            <span class="jc-appt-badge">{{ r.num_appointments }}</span>
                        </td>
                        <td>
                            <span class="jc-work-status">{{ r.work_status }}</span>
                        </td>
                        <td class="jc-desc-cell">{{ r.description }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" class="jc-empty-cell">No repeat-visit completed jobs found.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</section>

<div class="jc-footer-refresh">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="23 4 23 10 17 10"></polyline>
        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
    </svg>
    <span>Last refreshed: {{ last_refresh }}</span>
</div>

</main>

<footer>
    <p>© 2026 Hollcroft Analytics · Tulsa, Oklahoma · Data Analytics & Business Intelligence</p>
</footer>

<!-- Scripts -->
<script>
    // Revenue bar widths (set from data attributes)
    document.querySelectorAll('.jc-revenue-bar-fill').forEach(function(bar) {
        const width = bar.getAttribute('data-width');
        if (width) {
            bar.style.width = width + '%';
        }
    });

    // FTC gauge circle animation
    const gaugeCircle = document.querySelector('.jc-gauge-fill');
    if (gaugeCircle) {
        const percent = parseFloat(gaugeCircle.getAttribute('data-percent') || 0);
        const circumference = 2 * Math.PI * 80; // 2 * π * radius
        const dashValue = (percent / 100) * circumference;
        gaugeCircle.style.strokeDasharray = dashValue + ' ' + circumference;
    }

    // Roadmap progress calculation
    (function () {
        const items = Array.from(document.querySelectorAll(".jc-task-item"));
        const total = items.length;
        const done = items.filter(el => String(el.getAttribute("data-done") || "0") === "1").length;

        const doneEl = document.getElementById("roadmap-done");
        const totalEl = document.getElementById("roadmap-total");
        const pctEl = document.getElementById("roadmap-pct");
        const bar = document.getElementById("roadmap-progress-bar");

        if (doneEl) doneEl.textContent = String(done);
        if (totalEl) totalEl.textContent = String(total);

        const pct = total > 0 ? Math.round((done / total) * 100) : 0;
        if (pctEl) pctEl.textContent = String(pct);

        if (bar) {
            bar.style.width = pct + "%";
        }
    })();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const navToggle = document.querySelector('.nav-toggle');
    const navLinks = document.querySelector('.nav-links');
    if (navToggle && navLinks) {
        navToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });
    }
</script>

<script>
(function () {
  function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }
  function easeOut(t) { return 1 - Math.pow(1 - t, 3); }

  document.addEventListener("DOMContentLoaded", () => {
    const ring = document.querySelector(".jc-gauge-fill");
    const value = document.querySelector(".jc-gauge-value");
    if (!ring || !value) return;

    const target = clamp(
      Number(value.dataset.target || ring.dataset.percent || 0),
      0, 100
    );

    const r = Number(ring.getAttribute("r")) || 80;
    const circumference = 2 * Math.PI * r;

    ring.style.strokeDasharray = `${circumference}`;
    ring.style.strokeDashoffset = `${circumference}`;

    const start = performance.now();
    const duration = 2000;

    function animate(now) {
      const progress = clamp((now - start) / duration, 0, 1);
      const eased = easeOut(progress);

      const current = target * eased;

      value.textContent = `${current.toFixed(1)}%`;
      ring.style.strokeDashoffset = `${circumference * (1 - current / 100)}`;

      if (progress < 1) requestAnimationFrame(animate);
      else value.textContent = `${target.toFixed(1)}%`;
    }

    requestAnimationFrame(animate);
  });
})();
</script>


</body>
</html>