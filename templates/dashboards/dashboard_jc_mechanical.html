<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Client Dashboard | Hollcroft Analytics | Tulsa, OK</title>
    <meta name="description" content="Secure client dashboard by Hollcroft Analytics in Tulsa, OK. Dashboards, reporting, and business intelligence.">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Main site styles -->
    <link rel="stylesheet" href="style.css">
</head>

<body class="jc-dash">

<!-- NAVBAR -->
<header class="navbar">
    <div class="brand">
        <div class="brand-text">
            <div class="brand-name">Hollcroft Analytics</div>
            <div class="brand-sub">Tulsa, Oklahoma</div>
        </div>
    </div>

    <nav class="nav-links">
        <a href="{{ url_for('home') }}">Home</a>
        <a href="{{ url_for('contact') }}">Contact</a>
        <a href="{{ url_for('logout') }}" class="nav-login">Logout</a>
    </nav>

    <button class="nav-toggle" aria-label="Toggle navigation">&#9776;</button>
</header>

<!-- LOGO -->
<div class="text-center mb-4">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="Hollcroft Analytics logo – Tulsa, Oklahoma data analytics" class="dashboard-logo" loading="lazy">
</div>

<main id="main-content" role="main">

{% set ftc_bar_class =
    'bg-success' if first_time_completion_pct >= first_time_completion_target
    else 'bg-warning' if first_time_completion_pct >= 75
    else 'bg-danger'
%}

<!-- QUICK STATS BAR -->
<section class="jc-quick-stats" aria-label="Quick Stats">
    <div class="jc-stat">
        <span class="jc-stat-label">YTD Revenue</span>
        <span class="jc-stat-value">{{ total_revenue_ytd_display }}</span>
    </div>
    <div class="jc-stat">
        <span class="jc-stat-label">FTC Rate</span>
        <span class="jc-stat-value {% if first_time_completion_pct >= first_time_completion_target %}jc-stat-success{% elif first_time_completion_pct >= 75 %}jc-stat-warning{% else %}jc-stat-danger{% endif %}">{{ first_time_completion_pct }}%</span>
    </div>
    <div class="jc-stat">
        <span class="jc-stat-label">Completed Jobs</span>
        <span class="jc-stat-value">{{ completed_jobs }}</span>
    </div>
    <div class="jc-stat">
        <span class="jc-stat-label">Repeat Visits</span>
        <span class="jc-stat-value {% if repeat_visit_completed > 20 %}jc-stat-warning{% endif %}">{{ repeat_visit_completed }}</span>
    </div>
</section>

<!-- TOP DASHBOARD GRID -->
<section class="jc-dash-grid" aria-label="Top KPIs">

    <!-- Revenue: Total -->
    <article class="jc-card jc-card-rev" aria-labelledby="rev-total-title">
        <div class="jc-card-head">
            <div>
                <div class="jc-kicker">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                    Revenue KPI
                </div>
                <h2 id="rev-total-title" class="jc-title">Total Revenue (YTD)</h2>
            </div>
            <div class="jc-card-actions">
                <button class="jc-btn-icon" title="Download CSV">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </button>
                <button class="jc-btn-icon" title="Refresh">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 20 1 14 7 14"></polyline>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="jc-big-money">
            {{ total_revenue_ytd_display }}
            <span class="jc-trend-indicator jc-trend-up">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="18 15 12 9 6 15"></polyline>
                </svg>
                12%
            </span>
        </div>

        <div class="jc-subtext">
            Includes invoice statuses: paid, open, pending_payment
        </div>
    </article>

    <!-- Revenue: Breakdown -->
    <article class="jc-card jc-card-rev" aria-labelledby="rev-breakdown-title">
        <div class="jc-card-head">
            <div>
                <div class="jc-kicker">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    Revenue breakdown
                </div>
                <h2 id="rev-breakdown-title" class="jc-title">Revenue by Category (YTD)</h2>
            </div>
        </div>

        <div class="jc-subtext" style="margin-top:-4px;">
            Categories are derived from job tags. Unclassified items fall under "Other / Unclassified".
        </div>

        <div class="table-responsive jc-table-wrap">
            <table class="table table-sm table-striped align-middle jc-table-rev">
                <thead>
                    <tr>
                        <th scope="col">Category</th>
                        <th scope="col" class="text-end">Revenue</th>
                    </tr>
                </thead>
                <tbody>
                    {% if revenue_breakdown_ytd and revenue_breakdown_ytd|length > 0 %}
                        {% for r in revenue_breakdown_ytd %}
                            <tr>
                                <td class="jc-cell-main">{{ r.category }}</td>
                                <td class="text-end jc-cell-money">{{ r.revenue_display }}</td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="2" class="jc-empty">
                                No revenue rows found for YTD with statuses paid, open, pending_payment.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </article>

    <!-- FTC (spans full width on large screens) -->
    <article class="jc-card jc-card-wide" aria-labelledby="kpi-ftc-title">
        <div class="d-flex justify-content-between align-items-start flex-wrap">
            <div>
                <div class="jc-kicker">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 11 12 14 22 4"></polyline>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                    </svg>
                    Quality KPI
                </div>

                <h2 id="kpi-ftc-title" class="jc-title">
                    First-Time Completion
                </h2>

                <div class="ftc-percentage">
                    {{ first_time_completion_pct }}%
                </div>

                <div class="ftc-sub">
                    Target: {{ first_time_completion_target }}%
                    • Completed jobs counted: {{ completed_jobs }}
                </div>
            </div>

            <div class="text-end">
                <div class="jc-refresh-label">Last refreshed</div>
                <div class="jc-refresh-value">{{ last_refresh }}</div>
            </div>
        </div>

        <div class="mt-3">
            <div class="progress">
                <div
                    id="ftc-progress-bar"
                    class="progress-bar {{ ftc_bar_class }} progress-bar-striped"
                    role="progressbar"
                    data-ftc="{{ first_time_completion_pct }}"
                    aria-valuenow="{{ first_time_completion_pct }}"
                    aria-valuemin="0"
                    aria-valuemax="100"
                    style="width: 0%;">
                    {{ first_time_completion_pct }}%
                </div>
            </div>
        </div>

        <div class="mini-metrics">
            <div class="mini-metric">
                <div class="label">First-time (1 appt)</div>
                <div class="value">{{ first_time_completed }}</div>
            </div>
            <div class="mini-metric">
                <div class="label">Repeat visit (2+)</div>
                <div class="value">{{ repeat_visit_completed }}</div>
            </div>
            <div class="mini-metric">
                <div class="label">Repeat-visit rate</div>
                <div class="value">{{ repeat_visit_pct }}%</div>
            </div>
        </div>
    </article>

</section>

<!-- KPI EXPANSION ROADMAP -->
<section class="section-card roadmap" aria-labelledby="roadmap-title">

    <div class="roadmap-top">
        <div>
            <div class="roadmap-kicker">Build roadmap</div>
            <h2 id="roadmap-title" class="roadmap-title">KPI Expansion Progress</h2>
        </div>

        <div class="roadmap-badges">
            <span class="roadmap-pill">Status: In progress</span>
            <span class="roadmap-pill">Last refreshed: {{ last_refresh }}</span>
        </div>
    </div>

    <div class="roadmap-divider"></div>

    <div class="roadmap-progress">
        <div class="roadmap-progress-top">
            <div class="roadmap-progress-label">Overall completion</div>
            <div class="roadmap-progress-meta">
                <span id="roadmap-done">0</span>/<span id="roadmap-total">0</span> items complete
                • <span id="roadmap-pct">0</span>%
            </div>
        </div>

        <div class="progress" style="height: 14px;">
            <div id="roadmap-progress-bar"
                 class="progress-bar bg-info progress-bar-striped"
                 role="progressbar"
                 style="width: 0%;"
                 aria-valuenow="0"
                 aria-valuemin="0"
                 aria-valuemax="100">
            </div>
        </div>
    </div>

    <div class="roadmap-grid">

        <!-- Phase 1 -->
        <article class="phase-card" aria-label="Phase 1">
            <div class="phase-head">
                <h3 class="phase-title">Phase 1 (fast value)</h3>
                <div class="phase-meta">
                    <span class="meta-chip">Quick wins</span>
                    <span class="meta-chip">Lowest complexity</span>
                </div>
            </div>

            <ul class="phase-list">
                <li class="task-row" data-done="1">
                    <div class="task-left">
                        <div class="task-name">Total revenue by department</div>
                        <div class="task-note">Residential, commercial, maintenance, demand service, change out, plus service plan revenue.</div>
                    </div>
                    <div class="task-right">
                        <span class="diff easy">Difficulty: Very easy</span>
                        <span class="status-pill status-done">Done</span>
                    </div>
                </li>

                <li class="task-row" data-done="0">
                    <div class="task-left">
                        <div class="task-name">Average ticket (service only)</div>
                        <div class="task-note">Overall and per technician. Flag under $450.</div>
                    </div>
                    <div class="task-right">
                        <span class="diff easy">Difficulty: Easy</span>
                        <span class="status-pill status-notstarted">Not started</span>
                    </div>
                </li>

                <li class="task-row" data-done="0">
                    <div class="task-left">
                        <div class="task-name">Lead turnover</div>
                        <div class="task-note">Estimate won vs lost, estimate vs call.</div>
                    </div>
                    <div class="task-right">
                        <span class="diff med">Difficulty: Easy–medium</span>
                        <span class="status-pill status-notstarted">Not started</span>
                    </div>
                </li>

                <li class="task-row" data-done="0">
                    <div class="task-left">
                        <div class="task-name">DFO (Diagnostic Fee Only)</div>
                        <div class="task-note">Monthly and yearly. Flag under 5% as green.</div>
                    </div>
                    <div class="task-right">
                        <span class="diff med">Difficulty: Medium</span>
                        <span class="status-pill status-notstarted">Not started</span>
                    </div>
                </li>
            </ul>
        </article>

        <!-- Phase 2 -->
        <article class="phase-card" aria-label="Phase 2">
            <div class="phase-head">
                <h3 class="phase-title">Phase 2 (operational insight)</h3>
                <div class="phase-meta">
                    <span class="meta-chip">More definitions</span>
                    <span class="meta-chip">Better accountability</span>
                </div>
            </div>

            <ul class="phase-list">
                <li class="task-row" data-done="0">
                    <div class="task-left">
                        <div class="task-name">Club agreement conversions</div>
                        <div class="task-note">Service calls with Wizard Club member, conversion rate, flag under 50% as red.</div>
                    </div>
                    <div class="task-right">
                        <span class="diff med">Difficulty: Medium</span>
                        <span class="status-pill status-notstarted">Not started</span>
                    </div>
                </li>

                <li class="task-row" data-done="0">
                    <div class="task-left">
                        <div class="task-name">Callback percentage</div>
                        <div class="task-note">Service and install crews. Thresholds: ≤3% green, 3–7% orange, ≥8% red.</div>
                    </div>
                    <div class="task-right">
                        <span class="diff hard">Difficulty: Medium–hard</span>
                        <span class="status-pill status-notstarted">Not started</span>
                    </div>
                </li>

                <li class="task-row" data-done="0">
                    <div class="task-left">
                        <div class="task-name">Residential budget progress</div>
                        <div class="task-note">How much until monthly budget target is met (requires monthly target value).</div>
                    </div>
                    <div class="task-right">
                        <span class="diff med">Difficulty: Medium</span>
                        <span class="status-pill status-notstarted">Not started</span>
                    </div>
                </li>

                <li class="task-row" data-done="0">
                    <div class="task-left">
                        <div class="task-name">Revenue per employee</div>
                        <div class="task-note">Requires definition of active employees and time windows.</div>
                    </div>
                    <div class="task-right">
                        <span class="diff hard">Difficulty: Hard</span>
                        <span class="status-pill status-notstarted">Not started</span>
                    </div>
                </li>
            </ul>
        </article>

        <!-- Phase 3 -->
        <article class="phase-card phase-wide" aria-label="Phase 3">
            <div class="phase-head">
                <h3 class="phase-title">Phase 3 (advanced, premium KPIs)</h3>
                <div class="phase-meta">
                    <span class="meta-chip">Most complex</span>
                    <span class="meta-chip">Requires config tables</span>
                    <span class="meta-chip">Per technician cards</span>
                </div>
            </div>

            <ul class="phase-list">
                <li class="task-row" data-done="0">
                    <div class="task-left">
                        <div class="task-name">Service efficiency (billed hours vs paid hours)</div>
                        <div class="task-note">Billed hours vs paid hours</div>
                    </div>
                    <div class="task-right">
                        <span class="diff hard">Difficulty: Hard</span>
                        <span class="status-pill status-notstarted">Not started</span>
                    </div>
                </li>

                <li class="task-row" data-done="0">
                    <div class="task-left">
                        <div class="task-name">Gross profit per job per technician per hour (service techs only)</div>
                        <div class="task-note">
                            Needs parts cost, parts duration, job classification, fixed labor assumption ($525),
                            and clear attribution rules for multi-tech jobs. Target: $150/hr or greater is green.
                        </div>
                    </div>
                    <div class="task-right">
                        <span class="diff hard">Difficulty: Very hard</span>
                        <span class="status-pill status-notstarted">Not started</span>
                    </div>
                </li>

                <li class="task-row" data-done="0">
                    <div class="task-left">
                        <div class="task-name">Per technician KPI cards</div>
                        <div class="task-note">Cards per employee: average ticket, gross profit/hr, callbacks, first-time completion, DFO.</div>
                    </div>
                    <div class="task-right">
                        <span class="diff med">Difficulty: Medium</span>
                        <span class="status-pill status-notstarted">Not started</span>
                    </div>
                </li>
            </ul>

            <div class="roadmap-note">
                Note: Hard items depend on definitions and consistent tagging. If definitions change midstream,
                KPI logic may require rework.
            </div>
        </article>

    </div>
</section>

<!-- REPEAT JOBS TABLE -->
<section class="section-card" aria-labelledby="repeat-jobs-title">

    <h2 id="repeat-jobs-title" class="section-title">
        Repeat-Visit Completed Jobs (2+ appointments)
    </h2>

    <p class="text-muted jc-section-note">
        These jobs required at least one return trip. Reviewing these is the fastest way
        to improve First-Time Completion.
    </p>

    <div class="table-responsive">
        <table class="table table-sm table-striped align-middle jc-table-repeat">
            <thead>
                <tr>
                    <th scope="col">Completed</th>
                    <th scope="col">Customer</th>
                    <th scope="col">Appointments</th>
                    <th scope="col">Status</th>
                    <th scope="col">Description</th>
                </tr>
            </thead>
            <tbody>
                {% if repeat_jobs and repeat_jobs|length > 0 %}
                    {% for r in repeat_jobs %}
                        <tr>
                            <td>{{ r.completed_at_central }}</td>
                            <td>{{ r.customer_name }}</td>
                            <td>
                                <span class="badge text-bg-secondary">
                                    {{ r.num_appointments }}
                                </span>
                            </td>
                            <td>{{ r.work_status }}</td>
                            <td class="jc-desc-cell">{{ r.description }}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" class="text-muted">
                            No repeat-visit completed jobs found.
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

</section>

<div class="text-center mb-3 jc-last-refresh">
    <p class="text-muted">Last refreshed: {{ last_refresh }}</p>
</div>

</main>

<footer>
    <p>© 2026 Hollcroft Analytics · Tulsa, Oklahoma · Data Analytics & Business Intelligence</p>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // FTC progress bar animation
    const ftcBar = document.getElementById("ftc-progress-bar");
    if (ftcBar) {
        const pct = parseFloat(ftcBar.dataset.ftc || "0");
        setTimeout(() => {
            ftcBar.style.width = Math.max(0, Math.min(100, pct)) + "%";
        }, 100);
    }

    // Roadmap progress bar
    (function () {
        const items = Array.from(document.querySelectorAll(".phase-list .task-row"));
        const total = items.length;
        const done = items.filter(el => String(el.getAttribute("data-done") || "0") === "1").length;

        const doneEl = document.getElementById("roadmap-done");
        const totalEl = document.getElementById("roadmap-total");
        const pctEl = document.getElementById("roadmap-pct");
        const bar = document.getElementById("roadmap-progress-bar");

        if (doneEl) doneEl.textContent = String(done);
        if (totalEl) totalEl.textContent = String(total);

        const pct = total > 0 ? Math.round((done / total) * 100) : 0;
        if (pctEl) pctEl.textContent = String(pct);

        if (bar) {
            setTimeout(() => {
                bar.style.width = pct + "%";
                bar.setAttribute("aria-valuenow", String(pct));
            }, 100);
        }
    })();

    // Mobile nav toggle
    const navToggle = document.querySelector('.nav-toggle');
    const navLinks = document.querySelector('.nav-links');
    if (navToggle && navLinks) {
        navToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });
    }
</script>

</body>
</html>